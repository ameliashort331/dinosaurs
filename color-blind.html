<html>
<head>
  <script src="https://kit.fontawesome.com/aede5f8533.js" crossorigin="anonymous"></script>
  <meta charset="utf-8">
  <link rel="stylesheet" href="index.css">

  <link href="d3-geomap/d3-geomap-cb.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="jquery-csv.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Julius+Sans+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Monda&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bitter&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>


  <div id="modal" class="modal open">
    <div class="modal-container"><div class="container-top" style = "text-align:center;min-height:30%;">
      <p style = "font-family: Fjalla One;color:white;letter-spacing: -2px;font-size:68px;padding-top:90px;">DINOSAURS: BACK FOR ANOTHER BITE</p>

    </div>
    <div class="modal-content">

      <p style = "font-family:Bitter;font-size:20px;">
        The <a class="highlight" href="#"><span>Mesozoic Era</span></a>, an interval of Earth history from about 230 million to 65 million years ago, comprises three geologic time periods: <a class="highlight" href="#"><span>Triassic</span></a>, <a class="highlight" href="#"><span>Jurassic</span></a>, and <a class="highlight" href="#"><span>Cretaceous</span></a>.

        <br><br>
        Dinosaurs during this time had a variety of diets, but we can generally categorize dinosaurs into <a class="highlight" href="#"><span>carnivores</span></a>,
        <a class="highlight" href="#"><span>herbivores</span></a>, or <a class="highlight" href="#"><span>omnivores</span></a>.

        <br><br>
        The main goal of this visualization is to be able to see the correlation between dinosaur diet type and country with relation to the Mesozoic time period.
        These correlations are simple and easy to understand, so sit back, relax, and have fun exploring!
      </p>
      <div class="container" style = "margin-top:5%;text-align:center">
        <div class="row">
          <div class="col-sm">
            <button class="btn open-modal" style = "font-family: Bitter;" id="open-modal" onclick="color_triassic()">Triassic</button>
          </div>
          <div class="col-sm">
            <button class="btn open-modal" style = "font-family: Bitter;"  id="open-modal">Jurassic</button>
          </div>
          <div class="col-sm">
            <button class="btn open-modal" style = "font-family: Bitter;"  id="open-modal" onclick="color_cretaceous()">Cretaceous</button>
          </div>
        </div>
      </div>

    </div>
    <!-- <span id="close-modal" class="close-modal">&times;</span> -->
  </div>
</div>
<!-- The Modal -->
<div id="myModal" class="modal">
  <div class="container">
    <div class="row">
      <div class="col">
        <div id='chartcontainer' style = "font-family:Bitter">
          <svg id='chartsvg' />
        </div>
      </div>
      <div class="col">
        <!-- Modal content -->
        <div style = "width:700px;margin:auto;">
          <div id = "continentToggle"></div>
          <div class="modal-content" style = "background-color:#fff;width:900px;height:600px;position:relative;">
            <span class="close">&times;</span>
            <div id = "modalHeader">
              <p id = "modaltext"></p>
            </div>


            <div class="container">
              <div class="type">
                <span id = "all" class="col-lg-auto button" onclick = "getCountryName('all')">
                  All
                </span>
                <span id = "carnivores" class="col-lg-auto button" onclick = "getCountryName('carnivore')">
                  Carnivores
                </span>
                <span id = "herbivores" class="col-lg-auto button" onclick = "getCountryName('herbivore')">
                  Herbivores
                </span>
                <span id = "omnivores" class="col-lg-auto button" onclick = "getCountryName('omnivore')">
                  Omnivores
                </span>
                <span id = "other" class="col-lg-auto button" onclick = "getCountryName('other')">
                  Other
                </span>
              </div>
            </div>

            <div class = "line"></div>
            <div class="container">
  <div class="row">
    <div class="col-sm" style = "text-align:center;">
      <div id = "dino" style="width:300px;position: absolute;
      height: 330px;
      top: 170px;display:block;
      font-family: Bitter;background-size: contain;">No dinosaur selected</div>
    </div>
    <div class="col-sm">
      <div id = "results"></div>
    </div>
  </div>
</div>




            <div class="container" style = "position:absolute;bottom:5;text-align:center;background-color:white;">
              <!-- <img src="footer.png" alt="Italian Trulli"> -->
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>





<nav class="navigation" id="sidebar" style="display:none;">
  <div class="nav_icon">
    <i class="fas fa-bars"></i>
  </div>
  <ul class="nav_list" style = "font-family:Bitter">

    <li onclick="color_triassic()" class="list-item" data-tooltip="Codepen">
      <a>
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Triassic</span>
      </a>
    </li>

    <li class="list-item" data-tooltip="Codepen">
      <a href="#">
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Jurassic</span>
      </a>
    </li>

    <li class="list-item" data-tooltip="Codepen">
      <a href="#">
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Cretaceous</span>
      </a>
    </li>

    <li class="list-item" data-tooltip="Codepen">
      <a href="#">
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Color-blind mode</span>
      </a>
    </li>

    <li class="list-item" data-tooltip="Codepen">
      <a href="#">
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Dyslexia friendly</span>
      </a>
    </li>

    <li class="list-item" data-tooltip="Codepen">
      <a href="#">
        <i class="fab fa-codepen " style = "visibility:hidden"></i>
        <span class="text">Restore to default</span>
      </a>
    </li>
  </ul>
</nav>
<div id = "main" style="box-shadow: 0px 10px 50px 5px rgba(0, 0, 0, 0.5);background-color:white;padding-top:2%;margin-left:10%;padding-bottom:5%;margin-top:2%;border-radius: 25px;width:80%;min-height:90%;margin-right:3%">
  <div id = "periodtitle" style = "font-family:Bitter;font-size:50px;padding-left:3%;padding-bottom:0.5%;">
  </div>
  <ul class="no-bullets" style="font-family:Bitter;position:absolute;margin-left:5%;margin-top:10%">
  <li>
  	<span class="dot-c"></span> Carnivore
  </li>
  <li>
  	<span class="dot-h"></span> Herbivore
  </li>
  <li>
  	<span class="dot-om"></span> Omnivore
  </li>
  <li>
  	<span class="dot-o"></span> Other/Unknown
  </li>
  <li>
  	<span class="dot-n"></span> No data
  </li>
</ul>
  <div style = "text-align:center;height:600" onclick="getCountryName('all')" class="d3-geomap" id="map"></div>
</div>
<!-- <div>hiiii</div> -->

</body>
<script src="https://unpkg.com/d3@5.16.0/dist/d3.min.js"></script>
<script src="https://unpkg.com/topojson@3/dist/topojson.min.js"></script>
<script src="d3-geomap/d3-geomap.min.js"></script>
<script>
var map = d3.geomap()
.geofile('https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/topojson/world/countries.json')
.draw(d3.select('#map'));
</script>


<script>

function color_cretaceous() {
  document.getElementById("periodtitle").innerHTML = "Cretaceous Period";
  var flip = true;
  const carnivore = [];
  const herbivore = [];
  const omnivore = [];
  const other = [];
  const carnivore_codes = [];
  const herbivore_codes = [];
  const omnivore_codes = [];
  const other_codes = [];
  document.getElementById("modal").style.display = "none";
  document.getElementById("sidebar").style.display = "block";
  // document.getElementById("map").style.backgroundColor = "#defdff";

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/cretaceous_group.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];
      if (obj["Diet"] === "carnivore") {
        carnivore.push(obj["Country"]);
      } else if (obj["Diet"] === "herbivore") {
        herbivore.push(obj["Country"]);
      } else if (obj["Diet"] === "omnivore") {
        omnivore.push(obj["Country"]);
      } else {
        other.push(obj["Country"]);
      }
    }
  });

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/codes.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];

      for (var j = 0; j < carnivore.length; j++){
        if (obj.Country === carnivore[j]) {
          carnivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < herbivore.length; j++){
        if (obj.Country === herbivore[j]) {
          herbivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < omnivore.length; j++){
        if (obj.Country === omnivore[j]) {
          omnivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < other.length; j++){
        if (obj.Country === other[j]) {
          other_codes.push(obj["Alpha-3 code"]);
        }
      }
    }

    for (var i = 0; i < carnivore_codes.length; i++){
      var cols = document.getElementsByClassName("unit-" + carnivore_codes[i]);
      for(var j = 0; j < cols.length; j++) {
        cols[j].style.fill = "#e8f086";
      }
    }

    for (var i = 0; i < herbivore_codes.length; i++){
      var cols = document.getElementsByClassName("unit-" + herbivore_codes[i]);
      for(var j = 0; j < cols.length; j++) {
        cols[j].style.fill = "#6fde6e";
      }
    }

  });



}




function color_triassic() {
  document.getElementById("periodtitle").innerHTML = "Triassic Period";
  const carnivore = [];
  const herbivore = [];
  const omnivore = [];
  const other = [];
  const carnivore_codes = [];
  const herbivore_codes = [];
  const omnivore_codes = [];
  const other_codes = [];
  document.getElementById("modal").style.display = "none";
  document.getElementById("sidebar").style.display = "block";
  // document.getElementById("map").style.backgroundColor = "#defdff";
  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/codes.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var cols = document.getElementsByClassName("unit-" + json[i]);
      for(var j = 0; j < cols.length; j++) {
        cols[j].style.fill = "#262626";
      }
    }

  });

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/triassic_group.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];
      if (obj["Diet"] === "carnivore") {
        carnivore.push(obj["Country"]);
      } else if (obj["Diet"] === "herbivore") {
        herbivore.push(obj["Country"]);
      } else if (obj["Diet"] === "omnivore") {
        omnivore.push(obj["Country"]);
      } else {
        other.push(obj["Country"]);
      }
    }
  });

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/codes.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];

      for (var j = 0; j < carnivore.length; j++){
        if (obj.Country === carnivore[j]) {
          carnivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < herbivore.length; j++){
        if (obj.Country === herbivore[j]) {
          herbivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < omnivore.length; j++){
        if (obj.Country === omnivore[j]) {
          omnivore_codes.push(obj["Alpha-3 code"]);
        }
      }

      for (var j = 0; j < other.length; j++){
        if (obj.Country === other[j]) {
          other_codes.push(obj["Alpha-3 code"]);
        }
      }
    }

    for (var i = 0; i < carnivore_codes.length; i++){
      var cols = document.getElementsByClassName("unit-" + carnivore_codes[i]);
      for(var j = 0; j < cols.length; j++) {
        cols[j].style.fill = "#e8f086";
      }
    }

    for (var i = 0; i < herbivore_codes.length; i++){
      var cols = document.getElementsByClassName("unit-" + herbivore_codes[i]);
      for(var j = 0; j < cols.length; j++) {
        cols[j].style.fill = "#6fde6e";
      }
    }

  });



}
</script>

<script>
var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];
var countryName;
var continentName;
var country = true;







function getCountryName(type) {

  var x = document.getElementsByClassName("active");
  countryName = x[0].innerHTML.replace('<title>', '');
  countryName = countryName.replace('</title>', '');
  modal.style.display = "block";
  document.getElementById("modaltext").innerHTML = countryName;
  getDinosaurs(type);
  getContinent(countryName);
}

function getContinent(countryName) {
  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/Cretaceous.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];
      if (obj.Country == countryName) {
        continentName = obj.Continent;
        document.getElementById("continentToggle").innerHTML = "Switch to all dinosaurs from " + obj.Continent + " <i style = \"margin-left:2%\" class=\"fas fa-sync\" onclick = \"switchToContinent('" + obj.Continent + "')\"></i>";
      }
    }

  });
}

function switchToContinent(continent) {
  document.getElementById("modaltext").innerHTML = continentName;
  country = false;
  document.getElementById("continentToggle").innerHTML = "Switch to all dinosaurs from " + countryName + " <i style = \"margin-left:2%\" class=\"fas fa-sync\" onclick = \"switchToCountry('" + countryName + "')\"></i>";
  $("#dino-select-2").attr("id", "dino");

  changeChart();

  document.getElementById("dino").innerHTML = "No dinosaur selected";
  document.getElementById("results").innerHTML = '';

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/Cretaceous.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];
      if (obj.Continent == continentName) {
        var z = document.createElement('p'); // is a node
        z.innerHTML = obj.Name + "-" + obj.Diet;
        document.getElementById("results").appendChild(z);
      }
    }
  });
}

function switchToCountry(countryName) {
  document.getElementById("modaltext").innerHTML = countryName;
  country = false;
  document.getElementById("continentToggle").innerHTML = "Switch to all dinosaurs from " + continentName + " <i style = \"margin-left:2%\" class=\"fas fa-sync\" onclick = \"switchToContinent('" + continentName + "')\"></i>";

  $("#dino-select-2").attr("id", "dino");
  document.getElementById("dino").innerHTML = "No dinosaur selected";
  document.getElementById("results").innerHTML = '';

  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/Cretaceous.json", function(json) {
    for (var i = 0; i < json.length; i++){
      var obj = json[i];
      if (obj.Country == countryName) {
        var z = document.createElement('p'); // is a node
        z.innerHTML = obj.Name + "-" + obj.Diet;
        document.getElementById("results").appendChild(z);
      }
    }
  });
}

function getDinosaurs(type) {
  document.getElementById("results").innerHTML = '';
  $.getJSON("https://raw.githubusercontent.com/ameliashort331/dinosaurs/main/Cretaceous.json", function(json) {

    if (country) {
      if (type == 'all') {
        for (var i = 0; i < json.length; i++){
          var obj = json[i];
          if (obj.Country == countryName) {
            var z = document.createElement('p'); // is a node
            z.className = "dinoselect-" + obj.Name;

            z.onclick = function () {
              if(document.getElementById("dino")!=null) {
                document.getElementById("dino").innerHTML = "";
                $("#dino").attr("id", "dino-select");
                z.style.fontWeight = "bold";
              } else {
                $("#dino-select").attr("id", "dino-select-2");
                z.style.fontWeight = "bold";
              }

            };
            z.innerHTML = obj.Name + "-" + obj.Diet;
            document.getElementById("results").appendChild(z);
          }
        }
      } else {
        for (var i = 0; i < json.length; i++){
          var obj = json[i];
          if (obj.Diet == type) {
            var obj = json[i];
            if (obj.Country == countryName) {
              var z = document.createElement('p'); // is a node
              z.className = "dinoselect-" + obj.Name;
              z.onclick = function () {
              $("#dino").attr("id", "dino-select");
              };
              z.innerHTML = obj.Name + "-" + obj.Diet;
              document.getElementById("results").appendChild(z);
            }
          }
        }
      }
    } else {
      if (type == 'all') {
        for (var i = 0; i < json.length; i++){
          var obj = json[i];
          if (obj.Continent == continentName) {
            var z = document.createElement('p'); // is a node
            z.className = "dinoselect-" + obj.Name;
            z.onclick = function () {
            $("#dino").attr("id", "dino-select");
            };
            z.innerHTML = obj.Name + "-" + obj.Diet;
            document.getElementById("results").appendChild(z);
          }
        }
      } else {
        for (var i = 0; i < json.length; i++){
          var obj = json[i];
          if (obj.Diet == type) {
            var obj = json[i];
            if (obj.Continent == continentName) {
              var z = document.createElement('p'); // is a node
              z.className = "dinoselect-" + obj.Name;
              z.onclick = function () {
              $("#dino").attr("id", "dino-select");
              };
              z.innerHTML = obj.Name + "-" + obj.Diet;
              document.getElementById("results").appendChild(z);
            }
          }
        }
      }
    }



  });
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
  country = true;
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
    country = true;
  }
}
</script>

<script>
const btnOpenModal = document.getElementById("open-modal");
const btnCloseModal = document.getElementById("close-modal");
const modalElm = document.getElementById("modal");

btnOpenModal.addEventListener("click", function () {
  modalElm.classList.add("open");
});

btnCloseModal.addEventListener("click", function () {
  modalElm.classList.remove("open");
});

</script>


<script>
const sidebar = document.querySelector(".navigation");
const navIcon = document.querySelector(".fas");

navIcon.addEventListener("click", () => {
  sidebar.classList.toggle("active");
});

</script>


<script>
const sample = [
  {
    language: 'Herbivores',
    value: 97,
    color: '#000000'
  },
  {
    language: 'Carnivores',
    value: 39,
    color: '#00a2ee'
  },
  {
    language: 'Omnivores',
    value: 20,
    color: '#fbcb39'
  },
  {
    language: 'Other/Unknown',
    value: 4,
    color: '#007bc8'
  }
];

const svg = d3.select('svg');
const svgContainer = d3.select('#container');

const margin = 80;
const width = 500 - 2 * margin;
const height = 900 - 2 * margin;

const chart = svg.append('g')
.attr('transform', `translate(${margin}, ${margin})`);

const xScale = d3.scaleBand()
.range([0, width])
.domain(sample.map((s) => s.language))
.padding(0.4)

const yScale = d3.scaleLinear()
.range([height, 0])
.domain([0, 100]);

// vertical grid lines
// const makeXLines = () => d3.axisBottom()
//   .scale(xScale)

const makeYLines = () => d3.axisLeft()
.scale(yScale)

chart.append('g')
.attr('transform', `translate(0, ${height})`)
.call(d3.axisBottom(xScale));

chart.append('g')
.call(d3.axisLeft(yScale));

// vertical grid lines
// chart.append('g')
//   .attr('class', 'grid')
//   .attr('transform', `translate(0, ${height})`)
//   .call(makeXLines()
//     .tickSize(-height, 0, 0)
//     .tickFormat('')
//   )

chart.append('g')
.attr('class', 'grid')
.call(makeYLines()
.tickSize(-width, 0, 0)
.tickFormat('')
)

const barGroups = chart.selectAll()
.data(sample)
.enter()
.append('g')

barGroups
.append('rect')
.attr('class', 'bar')
.attr('x', (g) => xScale(g.language))
.attr('y', (g) => yScale(g.value))
.attr('height', (g) => height - yScale(g.value))
.attr('width', xScale.bandwidth())
.on('mouseenter', function (actual, i) {
  d3.selectAll('.value')
  .attr('opacity', 0)

  d3.select(this)
  .transition()
  .duration(300)
  .attr('opacity', 0.6)
  .attr('x', (a) => xScale(a.language) - 5)
  .attr('width', xScale.bandwidth() + 10)

  const y = yScale(actual.value)

  line = chart.append('line')
  .attr('id', 'limit')
  .attr('x1', 0)
  .attr('y1', y)
  .attr('x2', width)
  .attr('y2', y)

  barGroups.append('text')
  .attr('class', 'divergence')
  .attr('x', (a) => xScale(a.language) + xScale.bandwidth() / 2)
  .attr('y', (a) => yScale(a.value) + 30)
  .attr('fill', 'white')
  .attr('text-anchor', 'middle')
  .text((a, idx) => {
    const divergence = (a.value - actual.value).toFixed(1)

    let text = ''
    if (divergence > 0) text += '+'
    text += `${divergence}%`

    return idx !== i ? text : '';
  })

})
.on('mouseleave', function () {
  d3.selectAll('.value')
  .attr('opacity', 1)

  d3.select(this)
  .transition()
  .duration(300)
  .attr('opacity', 1)
  .attr('x', (a) => xScale(a.language))
  .attr('width', xScale.bandwidth())

  chart.selectAll('#limit').remove()
  chart.selectAll('.divergence').remove()
})

barGroups
.append('text')
.attr('class', 'value')
.attr('x', (a) => xScale(a.language) + xScale.bandwidth() / 2)
.attr('y', (a) => yScale(a.value) + 30)
.attr('text-anchor', 'middle')
.text((a) => `${a.value}`)

svg
.append('text')
.attr('class', 'label')
.attr('x', -(height / 2) - margin)
.attr('y', margin / 2.4)
.attr('transform', 'rotate(-90)')
.attr('text-anchor', 'middle')
.text('Number of dinosaur species')

svg.append('text')
.attr('class', 'label')
.attr('x', width / 2 + margin)
.attr('y', height + margin * 1.7)
.attr('text-anchor', 'middle')
.text('Diet Type')

svg.append('text')
.attr('class', 'title')
.attr('x', width / 2 + margin)
.attr('y', 40)
.attr('text-anchor', 'middle')
.text('China')

</script>



<script>
$('.dinoselect').click(function() {
    console.log("clicked!");
});
</script>



<script>
$('.dinoselect').click(function() {
    console.log("clicked!");
});
</script>


<script>
  function changeChart () {
    console.log("clicked");
    $("#chartsvg").empty();
    const sample = [
      {
        language: 'Herbivores',
        value: 196,
        color: '#000000'
      },
      {
        language: 'Carnivores',
        value: 98,
        color: '#00a2ee'
      },
      {
        language: 'Omnivores',
        value: 45,
        color: '#fbcb39'
      },
      {
        language: 'Other/Unknown',
        value: 6,
        color: '#007bc8'
      }
    ];

    const svg = d3.select('svg');
    const svgContainer = d3.select('#container');

    const margin = 80;
    const width = 500 - 2 * margin;
    const height = 900 - 2 * margin;

    const chart = svg.append('g')
    .attr('transform', `translate(${margin}, ${margin})`);

    const xScale = d3.scaleBand()
    .range([0, width])
    .domain(sample.map((s) => s.language))
    .padding(0.4)

    const yScale = d3.scaleLinear()
    .range([height, 0])
    .domain([0, 200]);

    // vertical grid lines
    // const makeXLines = () => d3.axisBottom()
    //   .scale(xScale)

    const makeYLines = () => d3.axisLeft()
    .scale(yScale)

    chart.append('g')
    .attr('transform', `translate(0, ${height})`)
    .call(d3.axisBottom(xScale));

    chart.append('g')
    .call(d3.axisLeft(yScale));

    // vertical grid lines
    // chart.append('g')
    //   .attr('class', 'grid')
    //   .attr('transform', `translate(0, ${height})`)
    //   .call(makeXLines()
    //     .tickSize(-height, 0, 0)
    //     .tickFormat('')
    //   )

    chart.append('g')
    .attr('class', 'grid')
    .call(makeYLines()
    .tickSize(-width, 0, 0)
    .tickFormat('')
    )

    const barGroups = chart.selectAll()
    .data(sample)
    .enter()
    .append('g')

    barGroups
    .append('rect')
    .attr('class', 'bar')
    .attr('x', (g) => xScale(g.language))
    .attr('y', (g) => yScale(g.value))
    .attr('height', (g) => height - yScale(g.value))
    .attr('width', xScale.bandwidth())
    .on('mouseenter', function (actual, i) {
      d3.selectAll('.value')
      .attr('opacity', 0)

      d3.select(this)
      .transition()
      .duration(300)
      .attr('opacity', 0.6)
      .attr('x', (a) => xScale(a.language) - 5)
      .attr('width', xScale.bandwidth() + 10)

      const y = yScale(actual.value)

      line = chart.append('line')
      .attr('id', 'limit')
      .attr('x1', 0)
      .attr('y1', y)
      .attr('x2', width)
      .attr('y2', y)

      barGroups.append('text')
      .attr('class', 'divergence')
      .attr('x', (a) => xScale(a.language) + xScale.bandwidth() / 2)
      .attr('y', (a) => yScale(a.value) + 30)
      .attr('fill', 'white')
      .attr('text-anchor', 'middle')
      .text((a, idx) => {
        const divergence = (a.value - actual.value).toFixed(1)

        let text = ''
        if (divergence > 0) text += '+'
        text += `${divergence}%`

        return idx !== i ? text : '';
      })

    })
    .on('mouseleave', function () {
      d3.selectAll('.value')
      .attr('opacity', 1)

      d3.select(this)
      .transition()
      .duration(300)
      .attr('opacity', 1)
      .attr('x', (a) => xScale(a.language))
      .attr('width', xScale.bandwidth())

      chart.selectAll('#limit').remove()
      chart.selectAll('.divergence').remove()
    })

    barGroups
    .append('text')
    .attr('class', 'value')
    .attr('x', (a) => xScale(a.language) + xScale.bandwidth() / 2)
    .attr('y', (a) => yScale(a.value) + 30)
    .attr('text-anchor', 'middle')
    .text((a) => `${a.value}`)

    svg
    .append('text')
    .attr('class', 'label')
    .attr('x', -(height / 2) - margin)
    .attr('y', margin / 2.4)
    .attr('transform', 'rotate(-90)')
    .attr('text-anchor', 'middle')
    .text('Number of dinosaur species')

    svg.append('text')
    .attr('class', 'label')
    .attr('x', width / 2 + margin)
    .attr('y', height + margin * 1.7)
    .attr('text-anchor', 'middle')
    .text('Diet Type')

    svg.append('text')
    .attr('class', 'title')
    .attr('x', width / 2 + margin)
    .attr('y', 40)
    .attr('text-anchor', 'middle')
    .text('China')


  }
</script>
</html>
